// Generated by CoffeeScript 1.4.0
(function() {

  require(['Facebook', 'handlebars', 'underscore', 'Util', 'jquery', 'fb-sdk', 'bootstrap'], function(Facebook, Handelbars, _, Util) {
    var displayAjaxLoader, displayErrorMsg, getResultDiv, self,
      _this = this;
    self = this;
    $('.req-me').click(function() {
      var $result;
      $result = getResultDiv(this);
      displayAjaxLoader($result);
      return Facebook.login().fail(function() {
        return displayErrorMsg($result);
      }).done(function(user) {
        $('.need-me').show();
        self.userId = user.id;
        return $result.html('<p><img src="http://graph.facebook.com/' + user.username + '/picture" atl="" height="40" /> ' + user.name + '</p>');
      });
    });
    $('.req-like').click(function() {
      var $result;
      $result = getResultDiv(this);
      displayAjaxLoader($result);
      return Facebook.api('me/likes', 'get', {
        limit: 100
      }).fail(function() {
        return displayErrorMsg($result);
      }).done(function(res) {
        var twoBestLikeCategories;
        twoBestLikeCategories = Util.getTwoBestLikeCategories(res);
        return $result.html('\
          <ul>\
            <li>' + twoBestLikeCategories.first.name + '</li>\
            <li>' + twoBestLikeCategories.second.name + '</li>\
          </ul>');
      });
    });
    $('.req-best-status').click(function() {
      var $result, deferred;
      $result = getResultDiv(this);
      displayAjaxLoader($result);
      deferred = $.Deferred();
      deferred.done(function(statuses) {
        self.statusesStats = Util.getStatusesStats(statuses);
        $result.html('\
        <ul>\
          <li>"' + self.statusesStats.twoBestStatuses.first.name + '" (' + self.statusesStats.twoBestStatuses.first.value + ' likes)</li>\
          <li>"' + self.statusesStats.twoBestStatuses.second.name + '" (' + self.statusesStats.twoBestStatuses.second.value + ' likes)</li>\
        </ul>');
        $('.need-statuses').show();
        $('.req-average-like-status').click(function() {
          $result = getResultDiv(this);
          displayAjaxLoader($result);
          return $result.html('<ul><li>Average : ' + self.statusesStats.average + ' likes per status</li></ul>');
        });
        return $('.req-pic').click(function() {
          $result = getResultDiv(this);
          displayAjaxLoader($result);
          return Facebook.api('me/photos', 'get', {
            limit: 1000
          }).fail(function() {
            return displayErrorMsg($result);
          }).done(function(res) {
            var twoBestTaggers;
            twoBestTaggers = Util.getTwoBestTaggers(res, self.userId);
            return $result.html('<ul><li>' + twoBestTaggers.first.name + '</li><Li>' + twoBestTaggers.second.name + '</li></ul>');
          });
        });
      });
      return Util.getAllStatuses(deferred);
    });
    getResultDiv = function(that) {
      return $(that).parent().find('.result');
    };
    displayErrorMsg = function(div) {
      return div.html('Can\'t resolve this request. Please try again.');
    };
    return displayAjaxLoader = function(div) {
      return div.html('<img src="img/ajax-loader.gif" alt="Loading..." />');
    };
  });

}).call(this);
