// Generated by CoffeeScript 1.4.0
(function() {

  define(['Util', 'Facebook'], function(Util, Facebook) {
    var AfterMe;
    AfterMe = (function() {

      function AfterMe() {}

      AfterMe.prototype["do"] = function(user, $result) {
        $('.step-2').click(function() {
          $result = Util.getResultDiv(this);
          Util.displayAjaxLoader($result);
          Facebook.api('me/friends', 'get', {
            limit: 1000
          }).fail(function() {
            return Util.displayErrorMsg($result);
          }).done(function(friends) {
            return $result.html('You have ' + friends.data.length + ' active friends');
          });
          return Facebook.api('me/groups', 'get', {
            limit: 1000
          }).fail(function() {
            return Util.displayErrorMsg($result);
          }).done(function(groups) {
            $result.append('<br/>You have ' + groups.data.length + ' groups');
            Util.setThisDone($result);
            return $('.need-are-you-social').fadeIn(1000);
          });
        });
        $('.step-3').click(function() {
          $result = Util.getResultDiv(this);
          Util.displayAjaxLoader($result);
          return Facebook.api('me/likes', 'get', {
            limit: 1000
          }).fail(function() {
            return Util.displayErrorMsg($result);
          }).done(function(res) {
            var twoBestLikeCategories;
            Util.setThisDone($result);
            twoBestLikeCategories = Util.getTwoBestLikeCategories(res);
            $result.html('\
              You like :<br>\
                ' + twoBestLikeCategories.first.name + '<br>\
                &amp; ' + twoBestLikeCategories.second.name + '');
            return Util.setThisDone($result);
          });
        });
        $('.need-me').fadeIn(1000);
        self.userId = parseInt(user.id);
        $result.html('<img src="http://graph.facebook.com/' + user.username + '/picture" id="user-picture" alt="" height="50" /><br/>' + user.name + '');
        Util.setThisDone($result);
        $('.step-7').click(function() {
          $result = Util.getResultDiv(this);
          Util.displayAjaxLoader($result);
          return Facebook.api('me/albums', 'get', {
            limit: 1000,
            fields: 'photos'
          }).done(function(albums) {
            Util.displayProgressBar($result, 66);
            return Facebook.api('me/photos', 'get', {
              limit: 1000
            }).done(function(photos) {
              self.photosStats = Util.getPhotosStats(albums, photos, self.userId);
              $result.html('\
                <ul>\
                  <li>' + self.photosStats.twoBestTaggers.first.name + '</li>\
                  <li>' + self.photosStats.twoBestTaggers.second.name + '</li>\
                </ul>');
              Util.setThisDone($result);
              return $('.need-photos').fadeIn(1000);
            }).fail(function() {
              return Util.displayErrorMsg($result);
            });
          }).fail(function() {
            return Util.displayErrorMsg($result);
          });
        });
        $('.step-8').click(function() {
          $result = Util.getResultDiv(this);
          Util.displayProgressBar($result);
          return $result.html('\
          <p>You have ' + self.photosStats.numberOfPics + ' pictures</p>\
        ');
        });
        return $('.step-9').click(function() {
          $result = Util.getResultDiv(this);
          Util.displayAjaxLoader($result);
          return $result.html('\
          <div class="span2">\
            <p><img src="' + self.photosStats.twoMostFamousPics.first.name + '" alt="First most famous picture" /><br />' + self.photosStats.twoMostFamousPics.first.value + ' likes</p>\
          </div>\
          <div class="span2">\
            <p><img src="' + self.photosStats.twoMostFamousPics.second.name + '" alt="Second most famous picture" /><br />' + self.photosStats.twoMostFamousPics.second.value + ' likes</p>\
          </div>\
        ');
        });
      };

      return AfterMe;

    })();
    return new AfterMe;
  });

}).call(this);
