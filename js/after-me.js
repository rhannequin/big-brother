// Generated by CoffeeScript 1.4.0
(function() {

  define(['Util'], function(Util) {
    var AfterMe;
    AfterMe = (function() {

      function AfterMe() {}

      AfterMe.prototype["do"] = function(user, $result) {
        $('.need-me').fadeIn(1000);
        self.userId = parseInt(user.id);
        $result.html('<img src="http://graph.facebook.com/' + user.username + '/picture" atl="" height="40" /><br/>' + user.name + '');
        Util.setThisDone($result);
        $('.req-pic').click(function() {
          $result = Util.getResultDiv(this);
          Util.displayProgressBar($result);
          return Facebook.api('me/albums', 'get', {
            limit: 1000,
            fields: 'photos'
          }).done(function(albums) {
            Util.displayProgressBar($result, 66);
            return Facebook.api('me/photos', 'get', {
              limit: 1000
            }).done(function(photos) {
              self.photosStats = Util.getPhotosStats(albums, photos, self.userId);
              $('.need-pics').show();
              return $result.html('\
                <ul>\
                  <li>' + self.photosStats.twoBestTaggers.first.name + '</li>\
                  <li>' + self.photosStats.twoBestTaggers.second.name + '</li>\
                </ul>');
            }).fail(function() {
              return Util.displayErrorMsg($result);
            });
          }).fail(function() {
            return Util.displayErrorMsg($result);
          });
        });
        $('.req-nb-pics').click(function() {
          $result = Util.getResultDiv(this);
          Util.displayProgressBar($result);
          return $result.html('\
          <p>You have ' + self.photosStats.numberOfPics + ' pictures</p>\
        ');
        });
        return $('.req-most-famous-pics').click(function() {
          $result = Util.getResultDiv(this);
          Util.displayAjaxLoader($result);
          return $result.html('\
          <div class="span2">\
            <p><img src="' + self.photosStats.twoMostFamousPics.first.name + '" alt="First most famous picture" /><br />' + self.photosStats.twoMostFamousPics.first.value + ' likes</p>\
          </div>\
          <div class="span2">\
            <p><img src="' + self.photosStats.twoMostFamousPics.second.name + '" alt="Second most famous picture" /><br />' + self.photosStats.twoMostFamousPics.second.value + ' likes</p>\
          </div>\
        ');
        });
      };

      return AfterMe;

    })();
    return new AfterMe;
  });

}).call(this);
